# 🔧 环境配置说明

## 📋 配置概览

本项目使用两个独立的服务：

| 功能 | 服务提供商 | API Key 配置项 | 获取地址 |
|------|-----------|---------------|----------|
| **对话模型（LLM）** | ModelScope | `OPENAI_API_KEY` | https://www.modelscope.cn/my/myaccesstoken |
| **语音合成（TTS）** | 阿里云 DashScope | `DASHSCOPE_API_KEY` | https://dashscope.console.aliyun.com/apiKey |

---

## ⚙️ 完整配置示例

在项目根目录创建或编辑 `.env` 文件：

```ini
# ============================================================
# LLM 对话模型配置（ModelScope）
# ============================================================

# ModelScope API Token
# 获取地址: https://www.modelscope.cn/my/myaccesstoken
OPENAI_API_KEY=ms-xxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# ModelScope API 端点
OPENAI_API_BASE=https://api-inference.modelscope.cn/v1/

# 对话模型选择
OPENAI_MODEL=Qwen/Qwen2.5-32B-Instruct

# LLM 提供商（使用 openai 兼容接口）
LLM_PROVIDER=openai

# LLM 参数
LLM_TEMPERATURE=0.8
LLM_MAX_TOKENS=500

# ============================================================
# TTS 语音合成配置（阿里云 DashScope）
# ============================================================

# 阿里云 DashScope API Key
# 获取地址: https://dashscope.console.aliyun.com/apiKey
DASHSCOPE_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# TTS 配置
TTS_ENABLED=true
TTS_VOICE=zhixiaobai
TTS_SPEED=1.0
TTS_PITCH=1.0

# ============================================================
# Web 服务配置
# ============================================================

WEB_HOST=0.0.0.0
WEB_PORT=8000

# ============================================================
# 游戏配置
# ============================================================

GAME_LANGUAGE=zh
DEBUG_MODE=false
```

---

## 🔑 获取 API Key

### 1. ModelScope Token（对话模型）

**用途**：AI 玩家的对话和推理

**获取步骤**：
1. 访问：https://www.modelscope.cn/my/myaccesstoken
2. 登录 ModelScope 账号
3. 复制 Access Token
4. 填入 `.env` 的 `OPENAI_API_KEY`

**Token 格式**：`ms-xxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

---

### 2. DashScope API Key（语音合成）

**用途**：将 AI 玩家的文字转换为语音

**获取步骤**：
1. 访问：https://dashscope.console.aliyun.com/apiKey
2. 登录阿里云账号（如果没有需要注册）
3. 创建或复制 API-KEY
4. 填入 `.env` 的 `DASHSCOPE_API_KEY`

**API Key 格式**：`sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

---

## 🎨 TTS 音色选项

| 音色代码 | 描述 | 性别 | 特点 | 推荐场景 |
|---------|------|------|------|----------|
| `zhixiaobai` | 智小白 | 女 | 活泼、清晰 | 默认推荐 ⭐ |
| `zhixiaoxia` | 智小夏 | 女 | 温柔、自然 | 女性角色 |
| `zhiyan` | 智妍 | 女 | 甜美、可爱 | 年轻角色 |
| `zhitian` | 智天 | 男 | 亲切、自然 | 男性角色 ⭐ |
| `zhigang` | 智刚 | 男 | 沉稳、磁性 | 成熟角色 |
| `zhibei` | 智贝 | 儿童 | 童真、可爱 | 特殊场景 |

**修改音色**：在 `.env` 中修改 `TTS_VOICE=zhitian`

---

## 🎯 对话模型选项

ModelScope 支持的通义千问系列模型：

| 模型名称 | 参数量 | 能力 | 速度 | 推荐场景 |
|---------|--------|------|------|----------|
| `Qwen/Qwen2.5-7B-Instruct` | 7B | ⭐⭐ | 快 | 开发测试 |
| `Qwen/Qwen2.5-14B-Instruct` | 14B | ⭐⭐⭐ | 中 | 快速游戏 |
| `Qwen/Qwen2.5-32B-Instruct` | 32B | ⭐⭐⭐⭐ | 中慢 | 推荐使用 ⭐ |
| `Qwen/Qwen3-Max` | 超大 | ⭐⭐⭐⭐⭐ | 慢 | 最佳体验 |

**修改模型**：在 `.env` 中修改 `OPENAI_MODEL=Qwen/Qwen3-Max`

---

## ✅ 验证配置

### 1. 检查配置文件

确保 `.env` 文件包含两个 API Key：

```bash
# 检查 ModelScope Token
echo %OPENAI_API_KEY%

# 检查 DashScope Key
echo %DASHSCOPE_API_KEY%
```

### 2. 测试 TTS 功能

```bash
python test_tts.py
```

**预期输出**：
```
✅ API 密钥已配置 (来源: DASHSCOPE_API_KEY): sk-xxx...
✅ 语音生成成功: speech_1_xxxxx.wav
```

### 3. 启动游戏测试

```bash
# 终端 1: 启动后端
python main.py --mode web

# 终端 2: 启动前端
cd frontend
npm run dev
```

访问 http://localhost:5173

---

## ❓ 常见问题

### Q1: 两个 API Key 都需要付费吗？

**A**: 
- **ModelScope**: 免费使用，有调用限制
- **DashScope**: 提供免费额度，个人使用足够

### Q2: 可以只配置对话模型，不用语音吗？

**A**: 可以！将 `TTS_ENABLED=false` 即可

### Q3: 两个服务能用同一个账号吗？

**A**: 不能。
- ModelScope 是独立平台
- DashScope 是阿里云服务
需要分别注册和获取 Key

### Q4: API Key 泄露了怎么办？

**A**: 
- ModelScope: 在 https://www.modelscope.cn/my/myaccesstoken 重置
- DashScope: 在控制台删除并创建新的

### Q5: 配置错误会有什么提示？

**A**: 
- 对话模型错误：游戏无法开始，玩家不发言
- TTS 错误：文字正常显示，但没有语音

---

## 🔒 安全建议

1. **不要提交 `.env` 文件到 Git**
   - 项目已配置 `.gitignore` 忽略
   
2. **定期更换 API Key**
   - 建议每 3-6 个月更换一次
   
3. **限制 API 权限**
   - DashScope 可以设置调用限额
   - ModelScope 注意监控使用量

---

## 📚 参考链接

### ModelScope
- **官网**: https://www.modelscope.cn
- **Token 管理**: https://www.modelscope.cn/my/myaccesstoken
- **模型列表**: https://www.modelscope.cn/models
- **API 文档**: https://www.modelscope.cn/docs

### DashScope
- **控制台**: https://dashscope.console.aliyun.com
- **API Key 管理**: https://dashscope.console.aliyun.com/apiKey
- **TTS 文档**: https://help.aliyun.com/zh/dashscope/developer-reference/api-text-to-speech
- **价格说明**: https://help.aliyun.com/zh/dashscope/developer-reference/tongyi-qianwen-metering-and-billing

---

## 🚀 快速开始检查清单

- [ ] 获取 ModelScope Token
- [ ] 获取 DashScope API Key
- [ ] 创建 `.env` 文件
- [ ] 填写两个 API Key
- [ ] 运行 `python test_tts.py` 测试
- [ ] 启动后端服务
- [ ] 启动前端服务
- [ ] 开始游戏！

---

**配置时间**: 2025-11-06  
**推荐配置**: ModelScope (对话) + DashScope (语音) ⭐  
**预计配置时长**: 10-15 分钟

